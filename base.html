<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>接入必读</title>
<style>
@import url("https://docs.spring.io/spring-boot/docs/current/reference/html/css/spring.css");

div .switch {
    margin-left: 8px;
    border-color: #406A2A;
    border-radius: 4px 4px 0 0;
}

div .switch--item {
    color: #406A2A;
    background-color: transparent;
}

div .switch--item.selected {
    background-color: #406A2A;
}

div .switch--item:not(:first-child) {
    border-color: #406A2A;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>接入必读</h1>
<div class="details">
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#接口地址">1. 接口地址</a></li>
<li><a href="#签名认证">2. 签名认证</a>
<ul class="sectlevel2">
<li><a href="#申请创建-api-key">2.1. 申请创建 API Key</a></li>
<li><a href="#签名说明">2.2. 签名说明</a></li>
<li><a href="#签名步骤">2.3. 签名步骤</a></li>
<li><a href="#签名失败">2.4. 签名失败</a></li>
</ul>
</li>
<li><a href="#代码实例">3. 代码实例</a>
<ul class="sectlevel2">
<li><a href="#javascript">3.1. javascript</a></li>
<li><a href="#python">3.2. Python</a></li>
</ul>
</li>
<li><a href="#错误码">4. 错误码</a></li>
<li><a href="#字段缩写对照表">5. 字段缩写对照表</a></li>
<li><a href="#sdk">6. SDK</a>
<ul class="sectlevel2">
<li><a href="#python-2">6.1. python</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="接口地址"><a class="anchor" href="#接口地址"></a>1. 接口地址</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>网站：</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.wbfutures.io" class="bare">https://www.wbfutures.io</a></p>
</li>
<li>
<p><a href="https://wbfutures.io" class="bare">https://wbfutures.io</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>API:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://api.wbfutures.pro" class="bare">https://api.wbfutures.pro</a></p>
</li>
<li>
<p>wss://ws.wbfutures.pro [注意请使用 <a href="https://socket.io/docs/client-api/">socket.io</a> 协议]</p>
</li>
</ul>
</div>
</li>
<li>
<p>API文档：</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://doc.wbfutures.pro" class="bare">https://doc.wbfutures.pro</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="签名认证"><a class="anchor" href="#签名认证"></a>2. 签名认证</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="申请创建-api-key"><a class="anchor" href="#申请创建-api-key"></a>2.1. 申请创建 API Key</h3>
<div class="paragraph">
<p>通过web端页面 创建API Key</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access Key API 访问密钥</p>
</li>
<li>
<p>Secret Key 签名认证加密所使用的密钥</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="签名说明"><a class="anchor" href="#签名说明"></a>2.2. 签名说明</h3>
<div class="paragraph">
<p>API 请求在通过 internet 传输的过程中极有可能被篡改，为了确保请求未被更改，除公共接口（基础信息，行情数据）外的私有接口均必须使用您的 API Key 做签名认证，以校验参数或参数值在传输途中是否发生了更改。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">一个合法的请求由以下几部分组成</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>方法请求地址：如 <a href="https://www.wbfutures.pro/api/v1/future/position" class="bare">https://www.wbfutures.pro/api/v1/future/position</a></p>
</li>
<li>
<p>API访问密钥(apiKey)：您申请的 API Key 中的 Access Key</p>
</li>
<li>
<p>时间戳(apiExpires)：您发出请求的时间戳，以秒为单位。如：1588262400</p>
</li>
<li>
<p>签名(signature)：签名计算得出的值，用于确保签名有效和未被篡改</p>
</li>
<li>
<p>必选和可选参数：每个方法都有一组用于定义 API 调用的必需参数和可选参数。GET和POST请求的参数都不参与签名。</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
注意：apiKey，apiExpires， signature三个参数都在请求头中，，另外需要设置&#8217;content-type' : 'application/json'`,参考以下实例(对应各自键值)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="js" class="language-js hljs">// 请求头必须包含
var headers = {
  'content-type' : 'application/json',
  'apiExpires': expires, //UNIX时间戳以秒为单位校验一分钟以内合法
  'apiKey': AccessKey, // API 访问密钥（您获取的ApiKey中的AccessKey）
  'signature': signature // 签名
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="签名步骤"><a class="anchor" href="#签名步骤"></a>2.3. 签名步骤</h3>
<div class="paragraph">
<p>假设您创建的API Key 如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Access Key = w3xxxxxx-19xxxxxx-25xxxxxx-3xxxx
Secret Key = aaxxxxxx-63xxxxxx-57xxxxxx-1xxxx</code></pre>
</div>
</div>
<div class="paragraph">
<p>您发起请求时，</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">时间戳  = 1588262400</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>在进行签名计算前，请先对参数规范化处理</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  apiKey：w3xxxxxx-19xxxxxx-25xxxxxx-3xxxx
  apiExpires：1588262400</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>按照ASCII码的顺序对apiKey, apiExpires 两个参数进行升序排序</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  apiExpires：1588262400
  apiKey：w3xxxxxx-19xxxxxx-25xxxxxx-3xxxx</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>排序后的参数按照“keyvalue”的格式拼接在一起</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  apiExpires1588262400apiKeyw3xxxxxx-19xxxxxx-25xxxxxx-3xxxx</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>将Secret Key拼接到上一步字符串末尾，作为签名字符串</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  apiExpires1588262400apiKeyw3xxxxxx-19xxxxxx-25xxxxxx-3xxxxaaxxxxxx-63xxxxxx-57xxxxxx-1xxxx</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>使用MD5对签名字符串求签名得到signature</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  md5(apiExpires1588262400apiKeyw3xxxxxx-19xxxxxx-25xxxxxx-3xxxxaaxxxxxx-63xxxxxx-57xxxxxx-1xxxx)
  = q8xxxxxx-49xxxxxx-05xxxxxx-6xxxx</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>最终签名认证请求的请求头，如下示例</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="js" class="language-js hljs">  // 请求头必须包含
  var headers = {
    'content-type' : 'application/json',
    'apiExpires': 1588262400, //UNIX时间戳以秒为单位
    'apiKey': 'w3xxxxxx-19xxxxxx-25xxxxxx-3xxxx', // API访问密钥
    'signature': 'q8xxxxxx-49xxxxxx-05xxxxxx-6xxxx' // 签名
  };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="签名失败"><a class="anchor" href="#签名失败"></a>2.4. 签名失败</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>检查 APIKey 是否有效,是否复制正确,是否有绑定 IP 白名单</p>
</li>
<li>
<p>检查时间戳是否是 UTC 当前时间戳，校验一分钟以内合法</p>
</li>
<li>
<p>检查参数签名数据格式是否按('apiExpires' + expires值 + 'apiKey' + accessKey值 + secretKey值)</p>
</li>
<li>
<p>检查编码utf-8</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="代码实例"><a class="anchor" href="#代码实例"></a>3. 代码实例</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="javascript"><a class="anchor" href="#javascript"></a>3.1. javascript</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">&lt;script language="JavaScript"&gt;
    var request = require("request");
    var crypto = require("crypto");

    var accessKey = "78a24e1a77de5c7ac23b948a3f41eba4";
    var secretKey = "164220f29534db3384b9a89d0655a226";
    var path = "/api/v1/order?filter=%7B%22orderId%22%3A%2211548326910655928%22%7D";
    var expires = 1583473773431; //new Date().getTime();

    var signature = md5('apiExpires' + expires +"apiKey" + accessKey + secretKey);
    var headers = {
        "content-type": "application/json",
        Accept: "application/json",
        apiExpires: expires,
        apikey: accessKey,
        signature: signature
    };

    const requestOptions = {
        headers: headers,
        url: "xxxx.io" + path,
        method: verb,
        body: postBody
    };

    request(requestOptions, function(error, response, body) {
        if (error) {
            console.log(error);
        }
        console.log(body);
    });
&lt;/script&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="python"><a class="anchor" href="#python"></a>3.2. Python</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">import time
import hashlib
import hmac
from urllib.parse import urlparse
# 签名是 md5('apiExpires' + expires +"apiKey" + accessKey + secretKey)的十六进制编码。
# verb 必须是大写的，url 是相对的，expires 必须是 unix 时间戳（以秒为单位）
# 并且数据（如果存在的话）必须是 JSON 格式，并且键值之间没有空格。
def generate_signature(accessKey, secretKey, expires):
    """Generate a request signature compatible with cloud."""

    print("Computing md5: %s" % verb + path + str(expires) + data)
    message = f'apiExpires{expires}apiKey{self.accessKey}{self.secretKey}'
    md5 = hashlib.md5()
    md5.update(sign.encode())
    signature = md5.hexdigest();
    # print(f'signature:{signature}')
    # signature = '6404770bb5334daea72d5e41722c4504'
    return signature

# expires = 1583473773431
# 或者你可以像以下这样生成:
# expires = int(round(time.time()) + 5)
# GET请求将参数json化，然后urlencode, 放在url参数后面(?filter=xxxxxxx), data为空字符串
# POST请求将参数json化成字符串(字符串不能有空格)，放在data参数的位置
print(generate_signature('78a24e1a77de5c7ac23b948a3f41eba4', '164220f29534db3384b9a89d0655a226', expires))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="错误码"><a class="anchor" href="#错误码"></a>4. 错误码</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">编码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">注释</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">成功</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">账户不存在</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">合约不存在</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用标识错误</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托价格不合法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托数量不合法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托数量超过限制</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保证金可用不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可用数量不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">账户被接管，禁止交易</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">账户被接管，禁止转出资金</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">合约禁止交易</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托方向不合法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1013</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托类型不合法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1016</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托数量低于最小委托单位</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1018</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托金额不合法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托不存在</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1020</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对手方没有订单</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1022</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该笔持仓可平仓数量不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1023</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">账户被接管，禁止平仓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1027</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">合约已经存在</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1028</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托笔数超过限制</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1029</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">持仓数量超过限制</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1031</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前合约存在与本次委托的保证金类型不同的持仓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1032</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初始保证金率错误</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1035</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁止转入转出保证金</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1036</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托价格超过限制</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1037</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">委托金额超过限制</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1042</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁止逐仓开仓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1044</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">市价委托消耗了过多的流动性档位</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1046</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前价格无法成为被动委托，订单将被撤销</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="字段缩写对照表"><a class="anchor" href="#字段缩写对照表"></a>5. 字段缩写对照表</h2>
<div class="sectionbody">
<div class="paragraph">
<p>为防止数据包过大，返回数据键值进行了压缩，参考下面对应关系</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="js" class="language-js hljs">{
    contractId: v.ci,
    result: {
        messageType: v.mt,
        applId: v.ai,
        contractId: v.ci,
        symbol: v.sb,
        tradeDate: v.td,
        time: v.te,
        lastPrice: v.lp,
        matchQty: v.mq,
        numTrades: v.nt,
        openPrice: v.op,
        priceHigh: v.ph,
        priceLow: v.pl,
        historyPriceHigh: v.hph,
        historyPriceLow: v.hpl,
        totalTurnover: v.tt,
        totalVolume: v.tv,
        totalBidVol: v.tbv,
        totalAskVol: v.tav,
        prevPrice: v.pp,
        clearPrice: v.cp,
        posiVol: v.pv,
        priceChangeRadio: v.pcr,
        priceChange: v.pc,
        lastUpdateId: v.lui,
        contractStatus: v.cs,
        deliveryPrice: v.dp,
        fundingRate: v.fr,
        predictionFundingRate: v.pfr,
        premiumIndex: v.pi,
        predictionPremiumIndex: v.ppi,
        fairBasis: v.fb,
        tradingsignal: v.ts,
        indexPrice: v.ip,
        signalLevel: v.sl
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sdk"><a class="anchor" href="#sdk"></a>6. SDK</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="python-2"><a class="anchor" href="#python-2"></a>6.1. python</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="python" class="language-python hljs">#!/usr/bin/python
# -*- coding: utf-8 -*-
#auther: Rexxar

import socketio
import os
import time
import hashlib
import hmac
import urllib
import threading
import requests
import json


class SDK():


    def __init__(self,config):
        '''初始化'''
        self.publicKey = config['apiKey']
        self.privateKey = config['secretKey']
        self.baseWsUrl = 'wss://ws.wbfutures.pro'
        self.baseRsUrl = 'https://www.wbfutures.pro/api'
        self.status = False  #websocket连接闸口

        self._setWebsocket() #连接websocket
        process = threading.Thread(target=self._ping) #建立心跳
        process.start()
        while not self.status:
            continue

    def _signature(self):
        '''签名'''
        expires = int(time.time()+5)   #timestamp
        sign = f'apiExpires{expires}apiKey{self.publicKey}{self.privateKey}'
        m = hashlib.md5()
        m.update(sign.encode())
        signature = m.hexdigest()
        return signature,expires


    def _getUrl(self,method,params=None):
        '''生成url'''
        baseRsUrl = self.baseRsUrl
        method,path = method.split(' ')
        req = {}
        signature,expires = self._signature() #拿到签名

        '''===判断参数结构==='''
        if (params is not None) and ('filter' in params):
            req = {'filter':json.dumps(params['filter'])}
        elif params is not None:
            for k in params:
                if params[k] is not None:
                    req[k] = params[k]
        req = urllib.parse.urlencode(req)

        '''===生成Url==='''
        if req=='':
            url = f'{baseRsUrl}{path}'
        else:
            url = f'{baseRsUrl}{path}?{req}'
        return url,signature,expires


    def _httpReq(self,method,params=None,body=None):
        '''请求'''
        url,signature,expires = self._getUrl(method,params)
        method = method.split(' ')[0]
        headers = {'content-type':'application/json',
                   'Accept':'application/json',
                   'apiExpires':str(expires),
                   'apiKey':self.publicKey,
                   'signature':signature}
        print(f'method:{method}')
        print(f'url:{url}')

        '''===不同请求方法==='''
        if method=='GET':
            res = requests.get(url,headers=headers)
        elif method=='POST':
            if body is not None:
                res = requests.post(url,headers=headers,data=body)
            else:
                res = requests.post(url,headers=headers)
        elif method=='DELETE':
            res = requests.delete(url,headers=headers)
        rsp = res.json()
        return rsp


    def _setWebsocket(self):
        '''配置websocket 自动重连'''
        sio = socketio.Client()
        @sio.event
        def connect():
            print('===WBF Websocket Server Connected!===')
            signature,expires = self._signature()
            auth = ['auth',{'header':{'type':1001},'body':{'apiKey':self.publicKey,'expires':expires,'signature':signature}}]
            print(auth)
            sio.emit(auth[0],auth[1]) #鉴权
        @sio.event
        def disconnect():
            print("===WBF Websocket Server Disconnected!===")
        @sio.on('auth')
        def rsp(data):
            situation = data['body']['msg']
            print(data)
            if situation=='success':
                print('===WBF Account Authentication Successfully===')
                self.status = True
            else:
                raise Exception(f"===WBF Account Authentication Failed!!===\nerror: {situation}")
        sio.connect(self.baseWsUrl) #连接websocket
        self.sio = sio #websocket实例


    def _ping(self):
        '''心跳发送 保持连接状态'''
        try:
            sio = self.sio
            t=0
            while t&lt;=10:
                if t==10:
                    sio.emit('ping')
                    t=0
                time.sleep(1)
                t+=1
        except:
            time.sleep(5)


    ''' ==========================================================================='''
    '''============================ Websocket Function ============================'''
    '''============================================================================'''

    def subBase(self,func):
        '''订阅基本信息'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'match'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('match',func)


    def subKline(self,symbol,period,func):
        '''订阅K线'''
        sio = self.sio
        periodDic={'1m':'60000','3m':'180000','5m':'300000',
                   '15m':'900000','30m':'1800000','1h':'3600000',
                   '2h':'7200000','4h':'14400000','6h':'21600000',
                   '12h':'43200000','1d':'86400000','1w':'604800000'}
        period = periodDic[period]
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_kline','params':{'symbols':[
               {'symbol':symbol,
                'ranges':[period]}]}}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_kline',func)


    def subLegalCoin(self,func):
        '''订阅法币'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'exchange'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('exchange',func)


    def subMarket(self,func):
        '''订阅市场数据'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_market_stat'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_market_stat',func)


    def subCoinPrice(self,func):
        '''订阅币价'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'coin_price'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('coin_price',func)


    def subMarketQuote(self,symbol,func):
        '''订阅市场quote'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_all_indicator',
                'params':{'symbols':[{'symbol':symbol}]}}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_all_indicator',func)


    def subRealtime(self,func):
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'realtime'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('realtime',func)


    def subDepth(self,symbol,func):
        '''订阅深度'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_snapshot_depth','params':{'symbols':[
               {'symbol':symbol}]}}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_snapshot_depth',func)


    def subQuote(self,symbol,func):
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_snapshot_indicator','params':{'symbols':[
               {'symbol':symbol}]}}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_snapshot_indicator',func)


    def subTick(self,symbol,func):
        '''订阅tick'''
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'future_tick','params':{'symbols':[
               {'symbol':symbol}]}}]}}
        print(req)
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('future_tick',func)


    def subNotice(self,func):
        sio = self.sio
        req = {'header':{'type':1003},
               'body':{'topics':[
               {'topic':'notice'}]}}
        print(req['body']['topics'][0])
        sio.emit('subscribe',req)
        sio.on('notice',func)


    ''' ==========================================================================='''
    '''============================ Restful Function ============================'''
    '''============================================================================'''

    def getCoinPrice(self):
        req = 'GET /api/v1/common/exchange/coins'
        data = self._httpReq(req)
        return data


    def getContract(self):
        req = 'GET /api/v1/future/queryContract'
        data = self._httpReq(req)
        return data


    def getCurrency(self):
        req = 'GET /api/v1/common/queryCurrency'
        data = self._httpReq(req)
        return data


    def getTradeCoin(self):
        req = 'GET /api/v1/common/exchange/list'
        data = self._httpReq(req)
        return data

    def getLegalCoin(self):
        req = 'GET /api/v1/common/exchange/list'
        data = self._httpReq(req)
        return data


    def getHistoryDelivery(self,type=2,pageNum=None,pageSize=None,contractId=None,sort=None):
        req = 'GET /api/v1/future/queryContractDeliveryList'
        data = self._httpReq(req,self._getUrl(req,params={'type':type,'pageNum':pageNum,
                                                          'pageSize':pageSize,'contractId':contractId,
                                                          'sort':sort}))
        return data


    def getAccount(self):
        req = 'GET /api/v1/future/user'
        data = self._httpReq(req,self._getUrl(req))
        return data


    def getBalance(self):
        '''获取资产'''
        req = 'GET /api/v1/future/margin'
        data = self._httpReq(req)
        return data


    def getMarginRate(self):
        req = 'GET /api/v1/future/queryAccountMarginRate'
        data = self._httpReq(req)
        return data


    def getUserParam(self,contractId):
        req = 'GET /api/v1/future/queryUserFutureParam'
        data = self._httpReq(req,params={'filter':{'contractId':contractId}})
        return data


    def getPosition(self):
        '''获取仓位'''
        req = 'GET /api/v1/future/position'
        data = self._httpReq(req)
        return data


    def getMargin(self,varietyId,contractId):
        req = 'GET /api/v1/future/queryVarietyMargin'
        data = self._httpReq(req,params={'filter':{'varietyId':varietyId,
                                         'contractId':contractId}})
        # data = self._httpReq(req,params={'varietyId':varietyId,'contractId':contractId})
        return data


    def makeOrder(self,side,quantity,price=None,orderType=1,positionEffect=1,marginType=1,marginRate=0,symbol=None,contractId=None,clientOrderId=None):
        '''下单'''
        req = 'POST /api/v1/future/order'
        body = {'side':side,'quantity':str(quantity),'orderType':orderType,'positionEffect':positionEffect,
                'marginType':marginType,'marginRate':str(marginRate)}

        extraKey = ['price','symbol','contractId']
        extra = [str(price),symbol,contractId]
        for i,e in enumerate(extra):
            if (e is not None) and (e != 'None'):
                body[extraKey[i]] = e
        print(body)
        data = self._httpReq(req,body=json.dumps(body,separators=(',',':')))
        return data


    def makeOrders(self,side,quantity,price,orderType=1,positionEffect=1,marginType=1,marginRate=0,symbol=None,contractId=None,clientOrderId=None):
        '''批量下单'''
        req = 'POST /api/v1/future/orders'
        body = {'orders':[{'side':side[i],'orderQty':str(quantity[i]),'orderType':orderType,'positionEffect':positionEffect,
                           'marginType':marginType,'orderPrice':str(price[i]),'contractId':contractId} for i in range(len(side))]}

        print(body)
        data = self._httpReq(req,body=json.dumps(body,separators=(',',':')))
        return data


    def cancelOrder(self,contractId,orderId):
        '''撤单'''
        req = 'DELETE /api/v1/future/order'
        data = self._httpReq(req,params={'filter':{'contractId':contractId,
                                                   'originalOrderId':str(orderId)}})
        return data

    def cancelAll(self):
        '''全撤'''
        req = 'DELETE /api/v1/future/order/all'
        data = self._httpReq(req)
        return data


    def queryOrder(self,orderId):
        '''查询订单'''
        req = 'GET /api/v1/future/order'
        data = self._httpReq(req,params={'filter':{'orderId':str(orderId)}})
        # data = self._httpReq(req,params={'orderId':str(orderId)})
        return data

    def queryOrders(self,orderIdList):
        req = 'GET /api/v1/future/orders'
        data = self._httpReq(req,params={'filter':{'orderId':[str(i) for i in orderIdList]}})
        return data


    def getOrderList(self):
        '''当前订单'''
        req = 'GET /api/v1/future/queryActiveOrder'
        data = self._httpReq(req)
        return data


    def getOrders(self):
        req = 'GET /api/v1/future/queryHisOrder'
        data = self._httpReq(req)
        return data


    def changeMargin(self,contractId,margin):
        req = 'POST /api/v1/future/position/transferMargin'
        body = {'contractId':contractId,'margin':str(margin)}
        # data = self._httpReq(req,params={'filter':body})
        data = self._httpReq(req,body=json.dumps(body,separators=(',',':')))
        return data


    def changeMarginType(self,contractId,initMarginRate,marginType):
        req = 'POST /api/v1/future/position/isolate'
        body = {'contractId':contractId,'initMarginRate':str(initMarginRate),'marginType':marginType}
        # data = self._httpReq(req,params={'filter':body})
        data = self._httpReq(req,body=json.dumps(body,separators=(',',':')))
        return data


    def transfer(self,currencyId,amount,transferType):
        req = 'POST /api/v1/future/transfer'
        body = {'currencyId':currencyId,'amount':amount,'transferType':transferType}
        data = self._httpReq(req,body=json.dumps(body,separators=(',',':')))
        return data


    def getForceLower(self):
        req = 'GET /api/v1/future/queryForceLower'
        data = self._httpReq(req)
        return data


    def getDeals(self):
        '''历史成交'''
        req = 'GET /api/v1/future/queryHisMatch'
        data = self._httpReq(req)
        return data


    def getMarketStats(self,contractId):
        req = 'GET /api​/v1​/futureQuot​/queryMarketStat'
        data = self._httpReq(req,params={'contractId':contractId})
        # data = self._httpReq(req,params={'filter':{'contractId':contractId}})
        return data

    def getQuote(self,contractId):
        req = 'GET /api/v1/futureQuot/querySnapshot'
        data = self._httpReq(req,params={'contractId':contractId})
        return data

    def getQuotes(self):
        req = 'GET /api/v1/futureQuot/queryIndicatorList'
        data = self._httpReq(req)
        return data

    def getKline(self,contractId,period):
        req = 'GET /api/v1/futureQuot/queryCandlestick'
        params = {'contractId':contractId,'range':period}
        print(params)
        data = self._httpReq(req,params=params)
        return data

    def getTick(self,contractId):
        req = 'GET /api/v1/futureQuot/queryTickTrade'
        data = self._httpReq(req,params={'contractId':contractId})
        return data


if __name__ == '__main__':
    config = {'apiKey':'*******',
              'secretKey':'******'}
    task = SDK(config)
    contractId = 100000

    '''======restful========'''
    data = task.getDeals()
    print(data)


    '''======websocket======'''
    # def handle(content):
    #     print(content)
    # task.subBase(handle)
    # task.subKline(contractId,'1m',handle)
    # task.subLegalCoin(handle)
    # task.subMarket(handle)
    # task.subCoinPrice(handle)
    # task.subMarketQuote(contractId,handle)
    # task.subRealtime(handle)
    # task.subDepth(contractId,handle)
    # task.subTick(contractId,handle)
    # task.subQuote(contractId,handle)
    # task.subNotice(handle)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2020-05-15 19:09:19 +0800
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<!-- <script src="tocbot-3.0.2/tocbot.js"></script> -->
<script src="https://docs.spring.io/spring-boot/docs/current/reference/html/js/tocbot/tocbot.min.js"></script>
<script src="https://docs.spring.io/spring-boot/docs/current/reference/html/js/toc.js"></script>
<script>
    var hs = document.getElementById("header-spring");
    var h1 = hs.getElementsByTagName("h1")[0];
    h1.innerHTML = "";

    img = document.createElement("img")
    img.setAttribute("src", "images/wbf.png")
    h1.appendChild(img)

</script>
</body>
</html>